# GameWuxing 邮件验证码系统

## 🎯 系统概述

本系统实现了完整的邮件验证码登录流程，包括：
- ✅ 服务器端6位数验证码生成算法
- ✅ 客户端发送邮件的服务器端请求
- ✅ 获取返回时间戳的功能
- ✅ 发送验证码+时间戳的接口
- ✅ 服务器端对收到的验证码进行验证的算法

## 📁 文件结构

```
src/Network/
├── LoginEvents.cs              # 网络事件定义
├── LoginServerHandler.cs       # 服务器端处理逻辑
├── EmailService.cs            # 邮件服务实现
└── EmailConfig.cs             # 邮件服务配置

src/UI/
└── LoginPanel.cs              # 客户端UI界面

email.config.example.json      # 邮件服务配置示例
```

## 🔧 核心功能

### 1. 验证码生成算法
- **算法**: 基于邮箱地址 + 时间戳 + 盐值的MD5哈希
- **输出**: 6位数字验证码
- **有效期**: 5分钟

### 2. 邮件发送服务
- **真实邮件**: 支持SMTP协议的邮件服务
- **模拟邮件**: 测试环境下的模拟服务
- **配置化**: 通过配置文件切换服务模式

### 3. 客户端功能
- **自动跳转**: 验证码输入框自动聚焦
- **倒计时**: 5分钟验证码有效期倒计时
- **错误处理**: 完整的错误提示和处理

### 4. 安全特性
- **时间戳验证**: 防止重放攻击
- **验证码过期**: 5分钟后自动失效
- **错误重试**: 支持重新发送验证码

## ⚙️ 配置说明

### 邮件服务配置
创建 `email.config.json` 文件（参考 `email.config.example.json`）：

```json
{
  "SmtpHost": "smtp.gmail.com",
  "SmtpPort": 587,
  "SmtpUsername": "your-email@gmail.com",
  "SmtpPassword": "your-app-password",
  "FromEmail": "your-email@gmail.com",
  "FromName": "GameWuxing",
  "EnableSsl": true,
  "UseMockService": false
}
```

### 配置选项
- **UseMockService**: `true` 使用模拟服务（推荐测试环境）
- **UseMockService**: `false` 使用真实邮件服务（生产环境）

## 🚀 使用流程

### 1. 客户端流程
1. 用户输入邮箱地址
2. 点击"发送验证码"按钮
3. 等待邮件发送响应
4. 切换到验证码输入界面
5. 查看倒计时（5分钟）
6. 输入6位验证码
7. 点击"验证并登录"

### 2. 服务器端流程
1. 接收验证码请求
2. 生成6位验证码
3. 发送邮件到用户邮箱
4. 返回时间戳给客户端
5. 接收验证码验证请求
6. 验证时间戳有效性（5分钟内）
7. 重新生成验证码进行比对
8. 返回验证结果

## 📧 邮件模板

系统发送的邮件包含：
- 专业的HTML邮件模板
- 清晰的安全提示
- 5分钟有效期提醒
- 客服联系方式

## 🧪 测试功能

### 模拟服务测试
在测试环境下，系统会自动使用模拟邮件服务：
- 随机10%的邮件发送失败率
- 1秒发送延迟模拟真实场景
- 详细日志记录

### 验证码测试
- 演示模式：自动填充"123456"
- 时间戳验证：确保5分钟内有效
- 错误处理：各种异常情况的处理

## 🔒 安全考虑

### 验证码安全
- 基于邮箱和时间戳的唯一性
- 添加盐值防止预测
- 5分钟有效期限制

### 邮件安全
- SSL/TLS加密传输
- 应用专用密码（非邮箱密码）
- 详细的错误日志

## 🐛 常见问题

### Q: 邮件发送失败怎么办？
A: 系统会自动使用模拟服务，并记录详细日志供调试。

### Q: 验证码过期了怎么办？
A: 用户可以点击"重新发送验证码"获取新的验证码。

### Q: 如何配置真实邮件服务？
A: 参考 `email.config.example.json` 创建配置文件。

### Q: 支持哪些邮件服务商？
A: 任何支持SMTP协议的邮件服务商（Gmail、QQ邮箱、163邮箱等）。

## 📋 后续优化建议

1. **验证码复杂度**: 可以考虑添加字母和数字混合
2. **频率限制**: 添加防刷机制，限制发送频率
3. **多语言支持**: 邮件模板国际化
4. **验证码缓存**: 服务器端缓存验证码，减少计算
5. **统计分析**: 记录验证码发送和验证成功率

## 🎯 总结

本邮件验证码系统提供了完整的解决方案，包括：
- 安全的验证码生成算法
- 可靠的邮件发送服务
- 友好的用户界面
- 完善的错误处理
- 灵活的配置选项

系统已经准备好投入生产使用，只需配置真实的邮件服务即可。